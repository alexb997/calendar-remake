<div class="calendar-container">
  <div class="calendar-header">
    <button mat-icon-button (click)="previousMonth()">
      <mat-icon>chevron_left</mat-icon>
    </button>
    <span>{{ monthsOfYear[currentMonth] }} {{ currentYear }}</span>
    <button mat-icon-button (click)="nextMonth()">
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>

  <div class="calendar-grid">
    <div class="calendar-day" *ngFor="let day of daysOfWeek">{{ day }}</div>
    <div 
      class="calendar-date" 
      *ngFor="let date of calendarDates"
      [ngClass]="{'empty': date === null}"
      (click)="selectDate(date)">
      <span *ngIf="date !== null">{{ date }}</span>
    </div>
  </div>

  <app-form-appointment [selectedDate]="selectedDate"></app-form-appointment>

  <app-edit-appointment
    *ngIf="editingAppointment && selectedDate"
    [appointment]="editingAppointment"
    [selectedDate]="selectedDate"
    (appointmentUpdated)="handleAppointmentUpdated()"
    (editCancelled)="handleEditCancelled()">
  </app-edit-appointment>

  <div class="appointment-list">
    <h3>Appointments for {{ selectedDate }}</h3>
    <div 
      cdkDropList
      [cdkDropListData]="getAppointmentsForDate(selectedDate!)"
      (cdkDropListDropped)="drop($event)"
      class="appointment-drop-list">
      <div 
        class="appointment-item"
        *ngFor="let appointment of getAppointmentsForDate(selectedDate!)"
        cdkDrag>
        <strong>{{ appointment.time }}</strong>: {{ appointment.description }}
        <button mat-icon-button (click)="startEditing(selectedDate!, appointment)">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button (click)="deleteAppointment(selectedDate!, appointment.id)">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>
  </div>
  
</div>
